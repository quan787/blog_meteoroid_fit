# 工具：MeteorConverter (数据转换器)

`omdx-converter` 可以将 UFOCapture 观测数据转换为标准的 omdx 格式。

## 准备工作

- 用户需要在UFOCapture中正确设置站点名称、经纬度等信息，站点位置采用wgs84坐标系，经纬度精确到小数点后5位，海拔精确到米。
- OBS 和 UFOCapture 都需要将帧率设置为摄像头的原生帧率，避免重复帧影响数据处理。
- 准备UFOCapture生成的视频文件、`.xml`和`*M.bmp`文件，文件名相同，位于同一个文件夹下。

## 启动方式

```bash
omdx-converter
```

## 操作流程指南

### 第一步：加载视频与去重

- 点击“读取 UFO 视频”选择 `.avi` 或 `.mp4` 文件。
- **智能去重**：由于原生帧率与软件设置帧率不同会导致出现重复帧，工具会自动比对相邻帧，去掉重复帧并估计原始帧率。
- 同时，工具会自动读取同目录下的 `.xml` 文件，自动填充站点、相机、经纬度等信息。

### 第二步：基础信息校对

- 用户可在左侧面板校对自动获取的元数据（流星名称、经纬度、海拔等）。相关信息建议UFO设置中填写完善。

### 第三步：时间校准

- XML 中的时间往往不够精确。用户需在播放器中找到**秒数跳变**的那一帧（即 System Time 秒数改变的瞬间）。应该使用摄像头生成的时间戳，而不是UFOCapture生成的时间戳，后者通常有延迟。
- 在“校准帧”栏自动显示该帧的序号，在下方时间框填写该时刻的精确时间。
- 结合去重后的有效帧率，系统将自动计算出每一帧的精确时间戳。完成后，数据将包含 `time` 标记。

### 第四步：遮罩与信号处理

- **遮罩绘制 (Mask)**：切换到“绘制遮罩”模式（红色笔刷），涂抹画面中的地景、树木等遮挡区域，和时间戳字幕区域。点击保存/加载按钮，可以将绘制的遮罩保存为 PNG 文件，处理后续同一个相机拍摄的流星时，可以点击加载按钮加载 PNG 遮罩文件。
- **流星区域绘制 (Signal)**：工具会自动尝试读取同名的 `*M.bmp` 文件（UFOCapture 生成的轨迹图），从中获取流星出现的区域。
  - UFOCapture生成的图像经常不覆盖整颗流星，用户此时需要切换到“绘制流星区域”模式（蓝色笔刷）手动修补，将整个流星轨迹全部覆盖。
- 完成后，数据将包含 `image` 标记。

### 第五步：恒星标定（可选）

- 切换到“点选恒星”模式。
- 在画面中双击击恒星位置，出现黄色标记。
- 点击打开恒星表，并在弹出的列表中，点击要填写的那一行，在下方文本框中输入恒星名称（支持中文名或 HIP 编号）。输入中文名的一部分，展开下拉菜单，可以选择匹配的恒星；也可以直接输入HIP编号，点击保存/修改按钮。
- 系统会自动计算该恒星在观测时刻的地心惯性坐标 (ECI)，并保存至数据中。
- 标记5颗以上恒星后，数据将包含 `star` 标记。

### 第六步：导出

- 当状态指示灯（TIME, IMAGE）变绿时，点击“保存 FITS”即可生成标准文件。
